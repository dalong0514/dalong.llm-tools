# book2md 章节文件名优化（chapter 主章节）

## 目标

- 修改 `scripts/book2md.py`：当章节标题以 `chapter <n>` 开头时，优化输出的章节 Markdown 文件名。
- 命名规则与 `epub2md` 保持一致：
  - `<source_stem>{n:02d}01-<rest_slug>.md`
  - `source_stem`：输入 Markdown 文件名去掉扩展名（例如 `2020159Domain-Specific-Languages`）
  - `rest_slug`：去掉 `chapter <n>` 后剩余标题的 ASCII 安全化 slug

## 实现

- 新增 `_CHAPTER_TITLE_RE` 与 `safe_chapter_markdown_filename()`：
  - 匹配 `chapter <n>`（忽略大小写），生成 `<source_stem>{n:02d}01-...` 文件名
  - 其他章节保持原 `{index:03d}-...` 规则不变
- 调整 `save_chapters()` 签名，传入 `source_stem` 用于生成前缀。

## 验证

### 输入文件

- `/Users/Daglas/Downloads/2020159Domain-Specific-Languages.md`

### 命令

```bash
python scripts/book2md.py "/Users/Daglas/Downloads/2020159Domain-Specific-Languages.md" "working/2020159Domain-Specific-Languages_data"
```

### 输出（节选）

`working/2020159Domain-Specific-Languages_data/` 中实际生成：

- `2020159Domain-Specific-Languages0101-an-introductory-example.md`
- `2020159Domain-Specific-Languages0201-using-domain-specific-languages.md`
- `2020159Domain-Specific-Languages0301-implementing-dsls.md`
- `2020159Domain-Specific-Languages0401-implementing-an-internal-dsl.md`


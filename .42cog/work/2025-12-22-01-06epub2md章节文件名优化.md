# epub2md 章节文件名优化（chapter 主章节）

## 目标

- 修改 `scripts/epub2md.py`：生成各章节 Markdown 文件时，对标题以 `chapter <n>` 开头的主章节，优化其输出文件名。
- 期望示例：`007-chapter-1-scaling.md` → `2025213The-Scaling-Era0101-scaling.md`
  - `2025213The-Scaling-Era`：传入的 epub 文件名（去掉扩展名）
  - `0101`：章节编号（`01` + `chapter` 的数字两位补零；`1` → `01`）

## 实现要点

- 新增基于正则的识别：当章节标题匹配 `^chapter\\s+(\\d+)`（忽略大小写）时，启用新命名规则。
- 新文件名格式：
  - `<epub_stem>01{chapter_number:02d}-<rest_slug>.md`
  - `rest_slug`：从标题中去掉 `chapter <n>` 后的剩余部分，做与旧逻辑一致的安全化（小写、非字母数字转 `-`）。
- 非 `chapter` 主章节：保持原有 `{index:03d}-<sanitized-title>.md` 规则不变。

## 变更文件

- `scripts/epub2md.py`

## 本地验证

### 命令

```bash
python scripts/epub2md.py "/Users/Daglas/dalong.knowledgetext/原文书籍/2025213The-Scaling-Era.epub" "working/2025213The-Scaling-Era_data"
```

### 结果（节选）

在 `working/2025213The-Scaling-Era_data/` 中生成的主章节文件名示例：

- `2025213The-Scaling-Era0101-scaling.md`
- `2025213The-Scaling-Era0102-evals.md`
- `2025213The-Scaling-Era0103-internals.md`
- `2025213The-Scaling-Era0104-safety.md`

